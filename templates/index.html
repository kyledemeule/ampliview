<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">

    <title>Ampliview - Amplify your Reviews</title>
  </head>
  <body>
    <header>
      <div class="collapse bg-dark" id="navbarHeader">
        <div class="container">
          <div class="row">
            <div class="col-sm-8 col-md-7 py-4">
              <h4 class="text-white">About</h4>
              <p class="text-muted">Ampliview is a tool to help you write better reviews for <a href="https://www.yelp.com/" target="_blank">Yelp</a>. It offers two major functions: it will analyze and tag the sentiment of each sentence in your review, and it will provide an overall score for your review on how likely it is to be marked as useful by reviewers on Yelp. Clicks the links on the right to get more information on each of these, or just start writing a review and click analyze!</p>
            </div>
            <div class="col-sm-4 offset-md-1 py-4">
              <h4 class="text-white">Info</h4>
              <ul class="list-unstyled">
                <li><a href="#" class="text-white">Sentiment Analysis</a></li>
                <li><a href="#" class="text-white">Usefulness Score</a></li>
                <li><a href="#" class="text-white">Sample Reviews</a></li>
                <li><a href="https://github.com/kyledemeule/ampliview" target="_blank" class="text-white">GitHub Repo</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="navbar navbar-dark bg-dark shadow-sm">
        <div class="container d-flex justify-content-between">
          <a href="#" class="navbar-brand d-flex align-items-center">
            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-textarea-resize" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M.5 4A2.5 2.5 0 0 1 3 1.5h12A2.5 2.5 0 0 1 17.5 4v8a2.5 2.5 0 0 1-2.5 2.5H3A2.5 2.5 0 0 1 .5 12V4zM3 2.5A1.5 1.5 0 0 0 1.5 4v8A1.5 1.5 0 0 0 3 13.5h12a1.5 1.5 0 0 0 1.5-1.5V4A1.5 1.5 0 0 0 15 2.5H3zm11.854 5.646a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708l3-3a.5.5 0 0 1 .708 0zm0 2.5a.5.5 0 0 1 0 .708l-.5.5a.5.5 0 0 1-.708-.708l.5-.5a.5.5 0 0 1 .708 0z"/></svg>
            <strong> Ampliview</strong>
          </a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarHeader" aria-controls="navbarHeader" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
        </div>
      </div>
    </header>
    <main>
      <div class="container">
        <div class="row">
          <div class="col-md">
            <h2>Review</h2>
            <textarea id="review-text" rows="20"></textarea>
            <button type="button" id="analyze-button" class="btn btn-primary">Analyze</button>
          </div>
          <div class="col-sm">
            <div>
            <h5 id="score">Usefulness score<span id="useful-prediction"></span></h5>
            <h2>Analysis</h2>
            </div>
            <div id="review-analysis"></div>
          </div>
        </div>
      </div>
    </main>
    <footer class="text-muted">
      <div class="container">
        <p>Want to see the code? <a href="https://github.com/kyledemeule/ampliview" target="_blank">Visit the GitHub Repo</a> or read the <a href="/docs/4.5/getting-started/introduction/" target="_blank">writeup</a>.</p>
      </div>
    </footer>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
    <script>
      function analyze_review() {
        var review_text = $("#review-text").val();
        $('#review-analysis').html("Loading...");
        $('#useful-prediction').html("");
        analyze_button_loading();

        var posting = $.post("analyze", { review_text: review_text } );
        posting.done(function( data ) {
          if (data.review_html) {
            $('#review-analysis').html(data.review_html);
            $('#useful-prediction').html(data.progress_html);
            $('[data-toggle="tooltip"]').tooltip()
          } else {
            $('#review-analysis').html("No review found.");
            $('#useful-prediction').html("");
          }
        });
        posting.fail(function( data ) {
            $('#review-analysis').html("There was an error analyzing the review.");
            $('#useful-prediction').html("");
        });
        posting.always(function( data ) {
            analyze_button_enable();
        });
      }

      function analyze_button_loading() {
        $('#analyze-button').prop('disabled', true);
        $('#analyze-button').html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>Loading...');
      }

      function analyze_button_enable() {
        $('#analyze-button').html("Analyze");
        $('#analyze-button').prop('disabled', false);
      }

      $(document).ready(function() {
          $("#analyze-button").click(function() {
            analyze_review();
          });

          analyze_review();
      });
    </script>
  </body>
</html>